\chapter{Тестирование}
Тестирование результатов выполнялось в два этапа: тестирование для найденных филогенетических паттернов и тестирование
восстановления деревьев с помощью MGRA2.

\section{Тестирование найденных паттернов}
В тестировании на симуляционных данных используется консервативная проверка правильности восстановления -
если восстановленное дерево не совпадает с верным (RF-метрика~\cite{Robinson1981} не дает расстояние 0) или
есть другое дерево имеющее ту же оценку, то дерево считается неправильно восстановленным.

\subsection{Тестирование на геномах со случайными брейкпоинт-графами}
Для тестирования найденных паттернов использовался подход описанный Wei Xu~\cite{xu2010exploring}.
Генерировались случайные геномы, состоящие из одной циклической хромосомы с 200 генами.
\begin{figure}[H]
  \includegraphics[max width=\textwidth]{fig/3/wei_xu_tree.png}
  \caption{Филогенетическое дерево симулированных геномов~\cite{xu2010exploring}}
  \label{fig:testing_phyl_tree}
\end{figure}
На~\ref{fig:testing_phyl_tree} показано филогенетическое дерево по которому генерировались тестовые четверки геномов.
Для генерации использовались значения $e_1 = v5, e_2 = v1 = v2 = v3 = v4$,
$e_1 = 1..5$, $e_2 = 5, 10, 20, 30, 40, 50, 60$.
Для каждой пары значений $(e_1, e_2)$ генерировалось 1000 четверок геномов с случайно выбранной топологией.
Результаты тестирования приведены в таблице ниже. Оценки $S_{CA}$ и $S_{MCA}$ взяты из~\cite{xu2010exploring},
оценка $S_{MCA+}$ получается включением информации полученной из филогенетических паттернов в оценку $S_{MCA}$.
\input{second_group_results}
Как видно из таблицы~\ref{table:second_group}, использование информации,
получаемой с помощью филогенетических паттернов дает улучшение эффективности восстановления относительно оценки $S_{MCA}$ от 0 до 1.5\%.
На основе того, что в некоторых случаях улучшений от использования информации полученной из филогенетических паттернов не происходило,
было проведено тестирования на случайных геномах, в брейкпоинт-графах которых гарантированно были искомые паттерны.

\subsection{Тестирование на геномах с отфильтрованными брейкпоинт-графами}
Генерация геномов производилась тем же образом, что и в предыдущем случае, но на параметрах $e_1 = 4, e_2 = 60$.
Было сгенерировано 20434 четверки геномов, из которых 1001 четверка содержала паттерны \q{мешок} и \q{цилиндр},
и 10001 хотя бы паттерн \q{мешок}.
\input{filtered_datasets_results}
Как видно из таблицы~\ref{table:filtered_graphs}, почти в половине случаев брейкпоинт-граф случайно сгенерированной четверки геномов содержал
хотя бы паттерн \q{мешок} и в этом случае наблюдалось улучшение эффективности восстановления относительно оценки $S_{MCA}$ на 1.72\%.
В случае присутствия и паттерна \q{мешок} и паттерна \q{цилиндр} (а это наблюдалось в примерно 5\% случаев) улучшение составило 2.5\%.

\section{Тестирование восстановления с помощью MGRA2}
\subsection{Тестирование на симуляционных данных}
Для тестирования восстановления деревьев с помощью MGRA2 генерировались случайные деревья на $N = 6, 10, 12$ геномах.
Каждый геном состоял из $G = 1000, 1500$ блоков.
На наборе из $N$ геномов строилось случайное полное бинарное дерево с $N$ листьями, далее проводился симуляционный процесс вдоль каждой ветки:
на при прохождении по ветке геном претерпевал случайное число эволюционных событий из диапазона $\lbrace \frac{E}{2}, E \rbrace$,
где $E = 100, 200$, $ID = 0.2, 0.4, 0.6$ из этих событий были вставками или удалениями одного блока, вставки и удаления происходили равновероятно.
Для сравнения в тестировании были взяты инструменты TIBA, GAS Phylogeny, MLWD и выделен компонент TreeInferer из инструмента Ragout.
MGRA2 запускался на двух оценках - \q{распределение} и \q{простые пути}.
Первая оценка использует как \q{свидетельства} ребра: если $\bb{Q}$ - все множество цветов,
то каждое ребро цвета $Q$ добавляет 1 к оценке разделения $Q|\bb{Q} \setminus Q$.
Вторая оценка использует идею простых путей и циклов в брейкпоинт-графе - путей и циклов, состоящих из вершин мультистепени 2,
также ищет паттерны \q{мешок} и \q{цилиндр} (присутствующие в них двойные ребра используются как свидельства того, что геномы
их составляющие должны быть вместе).
где ребра имеют цвета попеременно $Q$ и $\bb{Q} \setminus Q$.
Тестирование разделено на 2 части - с вставками и удалениями и без них.
В первой части участвуют все инструменты, во второй - только MGRA2 и MLWD,
так как другие не могут работать с данными в которых были вставки и удаления.

\subsubsection{Тестирование без вставок и удалений}
\input{mgra_no_indel_results}
Как видно из таблицы~\ref{table:no_indel_results}, вторая оценка, обозначенная как MGRA2\_SP не показала ожидаемой эффективности
(учитывая то, что она использует обобщенный паттерн, введенный Wei Xu),
когда первая оценка, обозначенная как MGRA2\_D, либо сравнивалась, либо незначительно проигрывала в восстановлении.

\subsubsection{Тестирование со вставками и удалениями}
\input{mgra_with_indel_results}
Как видно из таблицы~\ref{table:with_indel_results}, вторая оценка, обозначенная как SP, опять показала меньшую
по сравнению с первой оценкой, обозначенной как D, эффективность, которая в этом тесте лишь в двух случаях не восстановила все деревья идеально.

\subsection{Тестирование на реальных данных}
Для тестирования на реальных данных использовались данные предоставленные московской лабораторией М. С. Гельфанда.
Для тестирования использовались два набора данных: из рода Burkholderia и рода Yersinia.

В первом случае было восстановленное MGRA2 дерево не совпало с полученным биологическими методами.
Далее было замечено, что количество перестроек для полученной биологически и восстановленной топологий отличается на 1 из 95,
после этого в лаборатории было построено дерево на основе матрицы наличия/отсутствия гена.
Это дерево совпало с восстановленным MGRA2.

Восстановленное MGRA2 из второго набора данных дерево совпало с полученным биологическими методами в делении на три основные пандемии чумы.
Несовпадения произошли в поддеревьях с сомнительной топологией полученного биологически дерева.
